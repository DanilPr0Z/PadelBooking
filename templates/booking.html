{% extends 'base.html' %}
{% load static %}

{% block title %}–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - Paddle Booking{% endblock %}

{% block extra_css %}
<!-- FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
<style>
    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å */
    .fullcalendar-wrapper {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        transition: background-color 0.3s ease;
    }

    #main-calendar {
        max-width: 100%;
    }

    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    :root[data-theme="dark"] .fullcalendar-wrapper {
        background: var(--card-bg);
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    :root[data-theme="dark"] #main-calendar .fc-scrollgrid {
        border-color: var(--card-border) !important;
    }

    :root[data-theme="dark"] #main-calendar .fc-col-header-cell {
        background: rgba(158, 240, 26, 0.15) !important;
        color: var(--text-color) !important;
        border-color: var(--card-border) !important;
    }

    :root[data-theme="dark"] #main-calendar .fc-daygrid-day {
        background: var(--card-bg) !important;
        border-color: var(--card-border) !important;
    }

    :root[data-theme="dark"] #main-calendar .fc-daygrid-day-number {
        color: var(--text-color) !important;
    }

    :root[data-theme="dark"] #main-calendar .fc-day-other .fc-daygrid-day-number {
        color: var(--gray-color) !important;
        opacity: 0.5;
    }



    /* ========== –ö–û–ú–ü–ê–ö–¢–ù–´–ô FullCalendar ========== */

    #main-calendar {
        position: relative;
        z-index: 1;
    }

    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π toolbar */
    #main-calendar .fc-toolbar {
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%) !important;
        padding: 15px 20px !important;
        border-radius: 12px !important;
        margin-bottom: 15px !important;
        box-shadow: 0 4px 15px rgba(158, 240, 26, 0.3) !important;
    }

    #main-calendar .fc-toolbar-title {
        color: white !important;
        font-weight: 700 !important;
        font-size: 20px !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
    }

    /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    #main-calendar .fc-daygrid {
        height: auto !important;
    }

    #main-calendar .fc-scrollgrid {
        border-radius: 8px !important;
        overflow: hidden !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    #main-calendar .fc-button {
        background-color: white !important;
        color: #38b000 !important;
        border: 2px solid white !important;
        border-radius: 8px !important;
        font-weight: 600 !important;
        padding: 6px 14px !important;
        transition: all 0.3s ease !important;
        text-transform: capitalize !important;
        cursor: pointer !important;
        outline: none !important;
        font-size: 14px !important;
    }

    #main-calendar .fc-button:not(:disabled):hover {
        background-color: #bff167 !important;
        color: white !important;
        border-color: #bff167 !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }

    #main-calendar .fc-button:not(:disabled):active {
        transform: translateY(0) !important;
    }

    #main-calendar .fc-button-primary.fc-button-active,
    #main-calendar .fc-button-primary:not(:disabled).fc-button-active {
        background-color: #7cc00f !important;
        color: white !important;
        border-color: #7cc00f !important;
    }

    #main-calendar .fc-button:disabled {
        opacity: 0.5 !important;
        cursor: not-allowed !important;
    }

    /* –°–µ—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    #main-calendar .fc-scrollgrid {
        border: 1px solid #f0f0f0 !important;
    }

    #main-calendar .fc-col-header {
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.1) 0%, rgba(191, 241, 103, 0.1) 100%);
    }

    #main-calendar .fc-col-header-cell {
        padding: 8px 0 !important;
        font-weight: 700 !important;
        font-size: 13px !important;
        color: var(--secondary-color) !important;
        text-transform: uppercase !important;
    }

    #main-calendar .fc-daygrid-day {
        transition: all 0.2s !important;
        cursor: pointer !important;
        min-height: 80px !important;
    }

    #main-calendar .fc-daygrid-day:hover {
        background: rgba(158, 240, 26, 0.05) !important;
    }

    #main-calendar .fc-daygrid-day-number {
        color: #666 !important;
        font-weight: 600 !important;
        padding: 6px !important;
        font-size: 14px !important;
    }

    /* –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å */
    #main-calendar .fc-day-today {
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.15) 0%, rgba(191, 241, 103, 0.15) 100%) !important;
    }

    #main-calendar .fc-day-today .fc-daygrid-day-number {
        color: var(--primary-dark) !important;
        font-weight: 700 !important;
        background: white !important;
        border-radius: 50% !important;
        width: 28px !important;
        height: 28px !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* –í—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã */
    #main-calendar .fc-day.selected-date {
        background: rgba(158, 240, 26, 0.2) !important;
        border: 2px solid var(--primary-color) !important;
    }

    /* –°–æ–±—ã—Ç–∏—è/–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
    #main-calendar .fc-event {
        cursor: pointer !important;
        border: none !important;
        padding: 3px 6px !important;
        border-radius: 4px !important;
        font-size: 11px !important;
        font-weight: 600 !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
        transition: all 0.2s !important;
        margin: 1px 0 !important;
    }

    #main-calendar .fc-event:hover {
        transform: translateY(-1px) !important;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
        opacity: 1 !important;
        filter: brightness(1.1) !important;
    }

    /* –í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ */
    .fc .fc-day-sat,
    .fc .fc-day-sun {
        background: rgba(255, 152, 0, 0.03);
    }

    /* –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–µ—Ç–∫–∞ */
    .fc .fc-timegrid-slot {
        height: 40px;
    }

    .fc .fc-timegrid-slot-label {
        color: #666;
        font-weight: 600;
        font-size: 13px;
    }

    .fc .fc-timegrid-now-indicator-line {
        border-color: var(--primary-color);
        border-width: 2px;
    }

    .fc .fc-timegrid-now-indicator-arrow {
        border-color: var(--primary-color);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .fc .fc-toolbar {
            flex-direction: column;
            gap: 10px;
            padding: 15px;
        }

        .fc .fc-toolbar-title {
            font-size: 20px;
        }

        .fc .fc-button {
            font-size: 13px !important;
            padding: 6px 12px !important;
        }
    }

    /* ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–û–ë–´–¢–ò–Ø ========== */
    .event-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.3s ease;
    }

    .event-modal.active {
        display: flex;
    }

    .event-modal-content {
        background: white;
        padding: 0;
        border-radius: 16px;
        max-width: 550px;
        width: 90%;
        max-height: 85vh;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideInUp 0.4s ease;
    }

    .event-modal-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
        padding: 25px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 3px solid var(--primary-dark);
    }

    .event-modal-header h3 {
        margin: 0;
        color: white;
        font-size: 22px;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .event-modal-close {
        background: white;
        color: var(--primary-dark);
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        font-weight: 700;
    }

    .event-modal-close:hover {
        transform: rotate(90deg) scale(1.1);
        background: var(--primary-dark);
        color: white;
    }

    #modalBody {
        padding: 30px;
        overflow-y: auto;
        max-height: calc(85vh - 100px);
    }

    .event-detail {
        display: flex;
        justify-content: space-between;
        padding: 15px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .event-detail:last-child {
        border-bottom: none;
    }

    .event-detail-label {
        font-weight: 600;
        color: #666;
        font-size: 14px;
    }

    .event-detail-value {
        font-weight: 700;
        color: #333;
        text-align: right;
        font-size: 15px;
    }

    .event-actions {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    .btn-event {
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
    }

    .btn-view {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: white;
    }

    .btn-view:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(108, 117, 125, 0.3);
    }

    .btn-join {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
    }

    .btn-join:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(158, 240, 26, 0.4);
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(50px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    :root[data-theme="dark"] .event-modal-content {
        background: var(--card-bg);
    }

    :root[data-theme="dark"] #modalBody {
        background: var(--card-bg);
    }

    :root[data-theme="dark"] .event-detail {
        border-bottom-color: var(--card-border);
    }

    :root[data-theme="dark"] .event-detail-label {
        color: var(--gray-color);
    }

    :root[data-theme="dark"] .event-detail-value {
        color: var(--text-color);
    }

    .event-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .event-modal-close {
        cursor: pointer;
        font-size: 24px;
        color: #6b7280;
    }

    .event-modal-close:hover {
        color: #1a1a1a;
    }

    .event-detail {
        margin-bottom: 15px;
    }

    .event-detail-label {
        font-weight: 600;
        color: #6b7280;
        font-size: 12px;
        text-transform: uppercase;
        margin-bottom: 4px;
    }

    .event-detail-value {
        font-size: 16px;
        color: #1a1a1a;
    }

    .event-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-event {
        flex: 1;
        padding: 12px;
        border-radius: 8px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-view {
        background: #3b82f6;
        color: white;
    }

    .btn-view:hover {
        background: #2563eb;
    }

    .btn-join {
        background: #10b981;
        color: white;
    }

    .btn-join:hover {
        background: #059669;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–∏–ø–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
    .type-option .type-card {
        text-align: center;
        padding: 20px 15px;
        border: 3px solid #e5e7eb;
        border-radius: 12px;
        background: white;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .type-option:hover .type-card {
        border-color: var(--primary-color);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(158, 240, 26, 0.2);
    }

    .type-option.active .type-card {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.1) 0%, rgba(191, 241, 103, 0.1) 100%);
        box-shadow: 0 8px 20px rgba(158, 240, 26, 0.25);
        transform: scale(1.02);
    }

    .type-option .type-card i {
        color: var(--secondary-color);
        transition: all 0.3s;
    }

    .type-option.active .type-card i {
        color: var(--primary-color);
        transform: scale(1.1);
    }

    #coach-selection {
        animation: slideDown 0.4s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            max-height: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            max-height: 200px;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ç–æ–≤</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É, –∫–æ—Ä—Ç –∏ –≤—Ä–µ–º—è –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
</div>

<!-- –ö–ê–õ–ï–ù–î–ê–†–¨ FULLCALENDAR -->
<div class="fullcalendar-wrapper">
    <div id="main-calendar"></div>
</div>

<!-- –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô –í–´–ë–û–† –ö–û–†–¢–û–í -->
<div class="courts-horizontal-container">
    <div class="section-card">
        <h3><i class="fas fa-court-sport"></i> –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ç</h3>

        <div id="courts-horizontal-list" class="courts-horizontal-list">
            {% for court in courts %}
            <div class="court-horizontal-item {% if forloop.first %}active{% endif %}"
                 data-court-id="{{ court.id }}"
                 data-court-price="{{ court.price_per_hour }}"
                 onclick="selectCourt(this, {{ court.id }}, {{ court.price_per_hour }})"
                 style="cursor: pointer;">

                <div class="court-horizontal-image">
                    <i class="fas fa-tennis-ball"></i>
                </div>
                <div class="court-horizontal-info">
                    <h4>{{ court.name }}</h4>
                    <span class="court-price">{{ court.price_per_hour }} ‚ÇΩ/—á–∞—Å</span>
                    <p class="court-description">{{ court.description|truncatechars:60 }}</p>
                    <div class="court-status">
                        {% if court.is_available %}
                        <span class="status-available"><i class="fas fa-check-circle"></i> –î–æ—Å—Ç—É–ø–µ–Ω</span>
                        {% else %}
                        <span class="status-unavailable"><i class="fas fa-times-circle"></i> –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-courts">
                <i class="fas fa-tennis-ball"></i>
                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ä—Ç–æ–≤ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- –í–†–ï–ú–ï–ù–ù–´–ï –°–õ–û–¢–´ –° –†–ê–ó–î–ï–õ–ê–ú–ò -->
<div class="time-slots-container">
    <div class="section-card">
        <h3><i class="fas fa-clock"></i> –î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è</h3>

        <div id="time-slots-sections" class="time-slots-sections">
            <!-- –£–¢–†–û -->
            <div class="time-section morning-section">
                <div class="section-header" data-section="morning">
                    <h4><i class="fas fa-sun"></i> –£—Ç—Ä–æ (8:00 - 12:00)</h4>
                    <span class="toggle-arrow"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content" id="morning-slots" style="display: block;">
                    <div class="select-court-date">
                        <i class="fas fa-calendar-check"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –∫–æ—Ä—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è</p>
                    </div>
                </div>
            </div>

            <!-- –î–ï–ù–¨ -->
            <div class="time-section day-section">
                <div class="section-header" data-section="day">
                    <h4><i class="fas fa-cloud-sun"></i> –î–µ–Ω—å (12:00 - 17:00)</h4>
                    <span class="toggle-arrow"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content" id="day-slots" style="display: block;">
                    <div class="select-court-date">
                        <i class="fas fa-calendar-check"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –∫–æ—Ä—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è</p>
                    </div>
                </div>
            </div>

            <!-- –í–ï–ß–ï–† -->
            <div class="time-section evening-section">
                <div class="section-header" data-section="evening">
                    <h4><i class="fas fa-moon"></i> –í–µ—á–µ—Ä (17:00 - 22:00)</h4>
                    <span class="toggle-arrow"><i class="fas fa-chevron-down"></i></span>
                </div>
                <div class="section-content" id="evening-slots" style="display: block;">
                    <div class="select-court-date">
                        <i class="fas fa-calendar-check"></i>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –∫–æ—Ä—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í–´–ë–†–ê–ù–ù–û–ì–û –í–†–ï–ú–ï–ù–ò -->
<div id="selected-time-info" class="selected-time-info" style="display: none;">
    <div class="section-card">
        <h3><i class="fas fa-check-circle"></i> –í—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</h3>
        <div class="selected-details">
            <div class="selected-item">
                <span class="label">–ö–æ—Ä—Ç:</span>
                <span id="selected-court" class="value"></span>
            </div>
            <div class="selected-item">
                <span class="label">–î–∞—Ç–∞:</span>
                <span id="selected-date" class="value"></span>
            </div>
            <div class="selected-item">
                <span class="label">–í—Ä–µ–º—è:</span>
                <span id="selected-time" class="value"></span>
            </div>
            <div class="selected-item">
                <span class="label">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                <span id="selected-price" class="value"></span>
            </div>
            <button id="confirm-booking-btn" class="btn-primary">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="bookingConfirmModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div class="booking-details">
            <div class="booking-detail-item">
                <span class="detail-label">–ö–æ—Ä—Ç:</span>
                <span id="modal-court-name" class="detail-value"></span>
            </div>
            <div class="booking-detail-item">
                <span class="detail-label">–î–∞—Ç–∞:</span>
                <span id="modal-date" class="detail-value"></span>
            </div>
            <div class="booking-detail-item">
                <span class="detail-label">–í—Ä–µ–º—è:</span>
                <span id="modal-time" class="detail-value"></span>
            </div>
            <div class="booking-detail-item">
                <span class="detail-label">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                <span id="modal-price" class="detail-value"></span>
            </div>
        </div>

        <form id="booking-form" method="post" action="{% url 'create_booking' %}">
            {% csrf_token %}
            <input type="hidden" name="court_id" id="form-court-id">
            <input type="hidden" name="date" id="form-date">
            <input type="hidden" name="start_time" id="form-start-time">
            <input type="hidden" name="end_time" id="form-end-time">
            <input type="hidden" name="duration" id="form-duration" value="1">

            <!-- –¢–∏–ø –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="booking-type-selector" style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--secondary-color); font-size: 15px;">
                    <i class="fas fa-clipboard-list"></i> –¢–∏–ø –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
                </label>
                <div style="display: flex; gap: 12px;">
                    <label class="type-option active" style="flex: 1; cursor: pointer;">
                        <input type="radio" name="booking_type" value="game" checked style="display: none;">
                        <div class="type-card">
                            <i class="fas fa-users" style="font-size: 24px; margin-bottom: 8px;"></i>
                            <span style="font-weight: 600; font-size: 15px;">–ò–≥—Ä–∞</span>
                            <small style="display: block; font-size: 12px; color: #666; margin-top: 4px;">–ò–≥—Ä–∞—Ç—å —Å –¥—Ä—É–∑—å—è–º–∏</small>
                        </div>
                    </label>
                    <label class="type-option" style="flex: 1; cursor: pointer;">
                        <input type="radio" name="booking_type" value="training" style="display: none;">
                        <div class="type-card">
                            <i class="fas fa-dumbbell" style="font-size: 24px; margin-bottom: 8px;"></i>
                            <span style="font-weight: 600; font-size: 15px;">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
                            <small style="display: block; font-size: 12px; color: #666; margin-top: 4px;">–° —Ç—Ä–µ–Ω–µ—Ä–æ–º</small>
                        </div>
                    </label>
                </div>
            </div>

            <!-- –ò—â—É –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–≥—Ä) -->
            <div id="partner-search-section" style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #f0f8ff 0%, #e6f2ff 100%); border-radius: 12px; border: 2px solid #b3d9ff;">
                <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                    <input type="checkbox" name="looking_for_partner" id="looking-for-partner" value="1" style="
                        width: 20px;
                        height: 20px;
                        margin-right: 12px;
                        cursor: pointer;
                        accent-color: var(--primary-color);
                    ">
                    <div style="flex: 1;">
                        <span style="font-weight: 600; color: var(--secondary-color); font-size: 15px;">
                            <i class="fas fa-user-plus"></i> –ò—â—É –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –¥–ª—è –∏–≥—Ä—ã
                        </span>
                        <small style="display: block; font-size: 12px; color: #666; margin-top: 4px;">
                            –í–∞—à–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –∏—â—É—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                        </small>
                    </div>
                </label>
            </div>

            <!-- –í—ã–±–æ—Ä —Ç—Ä–µ–Ω–µ—Ä–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫) -->
            <div id="coach-selection" style="display: none; margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%); border-radius: 12px; border: 2px solid #ffe0b3;">
                <label style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--secondary-color); font-size: 15px;">
                    <i class="fas fa-user-tie"></i> –í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–µ—Ä–∞:
                </label>
                <select name="coach" id="coach-select" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; background: white;">
                    <option value="">–ë–µ–∑ —Ç—Ä–µ–Ω–µ—Ä–∞</option>
                    {% comment %}
                    <!-- –¢—Ä–µ–Ω–µ—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ AJAX -->
                    {% endcomment %}
                </select>
                <small style="display: block; margin-top: 8px; color: #666; font-size: 13px;">
                    <i class="fas fa-info-circle"></i> –í—ã–±–æ—Ä —Ç—Ä–µ–Ω–µ—Ä–∞ –∏–∑–º–µ–Ω–∏—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                </small>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-secondary cancel-booking">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-primary confirm-booking">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Å–æ–±—ã—Ç–∏—è (–ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –±—Ä–æ–Ω—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ) -->
<div id="eventDetailsModal" class="modal" style="display: none;">
    <div class="modal-content event-details-content">
        <span class="close-modal">&times;</span>
        <div class="event-header">
            <h2><i class="fas fa-calendar-check"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</h2>
            <span class="event-status-badge" id="event-status-badge">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</span>
        </div>

        <div class="event-details-grid">
            <div class="event-detail-card">
                <div class="event-detail-icon court-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="event-detail-content">
                    <span class="event-detail-label">–ö–æ—Ä—Ç</span>
                    <span class="event-detail-value" id="event-court-name">-</span>
                </div>
            </div>

            <div class="event-detail-card">
                <div class="event-detail-icon date-icon">
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="event-detail-content">
                    <span class="event-detail-label">–î–∞—Ç–∞</span>
                    <span class="event-detail-value" id="event-date">-</span>
                </div>
            </div>

            <div class="event-detail-card">
                <div class="event-detail-icon time-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="event-detail-content">
                    <span class="event-detail-label">–í—Ä–µ–º—è</span>
                    <span class="event-detail-value" id="event-time">-</span>
                </div>
            </div>

            <div class="event-detail-card">
                <div class="event-detail-icon user-icon">
                    <i class="fas fa-user"></i>
                </div>
                <div class="event-detail-content">
                    <span class="event-detail-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</span>
                    <span class="event-detail-value" id="event-creator">-</span>
                </div>
            </div>

            <div class="event-detail-card">
                <div class="event-detail-icon price-icon">
                    <i class="fas fa-ruble-sign"></i>
                </div>
                <div class="event-detail-content">
                    <span class="event-detail-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                    <span class="event-detail-value" id="event-price">-</span>
                </div>
            </div>

            <div class="event-detail-card">
                <div class="event-detail-icon players-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="event-detail-content">
                    <span class="event-detail-label">–ò–≥—Ä–æ–∫–∏</span>
                    <span class="event-detail-value" id="event-players">-</span>
                </div>
            </div>
        </div>

        <div class="event-actions" id="event-actions">
            <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –±—Ä–æ–Ω–∏ -->
        </div>
    </div>
</div>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    .calendar-container {
        margin-bottom: 30px;
    }

    /* –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô –í–´–ë–û–† –ö–û–†–¢–û–í */
    .courts-horizontal-container {
        margin-bottom: 30px;
    }

    .courts-horizontal-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .court-horizontal-item {
        background: white;
        border-radius: 15px;
        padding: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid #eee;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .court-horizontal-item:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 30px rgba(158, 240, 26, 0.15);
        border-color: #bff167;
    }

    .court-horizontal-item.active {
        border-color: #9ef01a;
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.05) 0%, rgba(191, 241, 103, 0.05) 100%);
        box-shadow: 0 15px 35px rgba(158, 240, 26, 0.2);
    }

    .court-horizontal-image {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
    }

    .court-horizontal-image i {
        font-size: 40px;
        color: white;
    }

    .court-horizontal-info h4 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 20px;
        font-weight: 700;
    }

    .court-price {
        display: inline-block;
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 15px;
        box-shadow: 0 3px 8px rgba(158, 240, 26, 0.3);
    }

    .court-description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 15px;
        min-height: 40px;
    }

    .court-status {
        font-size: 14px;
        font-weight: 600;
    }

    .status-available {
        color: #38b000;
    }

    .status-unavailable {
        color: #dc3545;
    }

    /* –í–†–ï–ú–ï–ù–ù–´–ï –°–õ–û–¢–´ –° –†–ê–ó–î–ï–õ–ê–ú–ò */
    .time-slots-container {
        margin-bottom: 30px;
    }

    .time-slots-sections {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .time-section {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        border: 2px solid #f0f0f0;
        transition: all 0.3s ease;
    }

    .time-section.morning-section .section-header {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
    }

    .time-section.day-section .section-header {
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    }

    .time-section.evening-section .section-header {
        background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
    }

    .section-header {
        padding: 20px 25px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
        user-select: none;
    }

    .section-header h4 {
        margin: 0;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-header h4 i {
        font-size: 20px;
    }

    .toggle-arrow {
        transition: transform 0.3s ease;
    }

    .section-content {
        padding: 25px;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* –°–ï–¢–ö–ê –í–†–ï–ú–ï–ù–ù–´–• –°–õ–û–¢–û–í */
    .time-slots-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 15px;
    }

    .time-slot-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid #eee;
        text-align: center;
        position: relative;
    }

    .time-slot-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .time-slot-card.available {
        border-color: #bff167;
    }

    .time-slot-card.available:hover {
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        border-color: #9ef01a;
    }

    .time-slot-card.available:hover .slot-time,
    .time-slot-card.available:hover .slot-price {
        color: white;
    }

    .time-slot-card.unavailable {
        opacity: 0.5;
        cursor: not-allowed;
        background: #f8f8f8;
    }

    .slot-time {
        display: block;
        font-weight: 700;
        color: #333;
        font-size: 18px;
        margin-bottom: 8px;
    }

    .slot-price {
        display: block;
        font-size: 16px;
        color: #38b000;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .slot-status {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .time-slot-card.available .slot-status {
        color: #38b000;
    }

    .time-slot-card.unavailable .slot-status {
        color: #dc3545;
    }

    /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í–´–ë–†–ê–ù–ù–û–ì–û –í–†–ï–ú–ï–ù–ò */
    .selected-time-info {
        margin-top: 30px;
        animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .selected-details {
        background: linear-gradient(135deg, #f8fff8 0%, #f0fff0 100%);
        border-radius: 12px;
        padding: 25px;
        border: 2px solid #bff167;
    }

    .selected-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .selected-item:last-child {
        border-bottom: none;
        padding-top: 20px;
        margin-top: 10px;
    }

    .selected-item .label {
        font-weight: 600;
        color: #555;
        font-size: 16px;
    }

    .selected-item .value {
        font-weight: 700;
        color: #333;
        font-size: 18px;
    }

    #confirm-booking-btn {
        width: 100%;
        margin-top: 10px;
        padding: 15px;
        font-size: 18px;
        font-weight: 700;
    }

    /* –°–û–û–ë–©–ï–ù–ò–Ø */
    .select-court-date {
        text-align: center;
        padding: 40px 20px;
        color: #888;
        grid-column: 1 / -1;
    }

    .select-court-date i {
        font-size: 48px;
        margin-bottom: 15px;
        color: #ccc;
    }

    .select-court-date p {
        margin: 0;
        font-size: 16px;
    }

    .loading {
        text-align: center;
        padding: 30px;
        color: #666;
        grid-column: 1 / -1;
    }

    .loading i {
        margin-right: 10px;
    }

    .error-message {
        text-align: center;
        padding: 30px;
        color: #dc3545;
        grid-column: 1 / -1;
    }

    .error-message i {
        margin-right: 10px;
    }

    /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
    @media (max-width: 1200px) {
        .courts-horizontal-list {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .courts-horizontal-list {
            grid-template-columns: 1fr;
        }

        .time-slots-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .section-header {
            padding: 15px 20px;
        }

        .section-header h4 {
            font-size: 16px;
        }

        .time-slot-card {
            padding: 15px;
        }

        .slot-time {
            font-size: 16px;
        }
    }

    @media (max-width: 480px) {
        .time-slots-grid {
            grid-template-columns: 1fr;
        }

        .court-horizontal-item {
            padding: 20px;
        }

        .selected-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }

        .selected-item .value {
            font-size: 16px;
        }
    }

    /* ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –° –î–ï–¢–ê–õ–Ø–ú–ò –°–û–ë–´–¢–ò–Ø ========== */
    .event-details-content {
        max-width: 600px;
        width: 90%;
    }

    .event-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--card-border);
    }

    .event-header h2 {
        margin: 0;
        color: var(--secondary-color);
        font-size: 1.6rem;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .event-header i {
        color: var(--primary-color);
    }

    .event-status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .event-status-badge.status-confirmed {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 100%);
        color: #10b981;
        border: 2px solid rgba(16, 185, 129, 0.3);
    }

    .event-status-badge.status-pending {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.2) 100%);
        color: #f59e0b;
        border: 2px solid rgba(245, 158, 11, 0.3);
    }

    .event-status-badge.status-cancelled {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.2) 100%);
        color: #ef4444;
        border: 2px solid rgba(239, 68, 68, 0.3);
    }

    .event-details-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 25px;
    }

    .event-detail-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s;
    }

    .event-detail-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .event-detail-icon {
        width: 45px;
        height: 45px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        flex-shrink: 0;
    }

    .event-detail-icon.court-icon {
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.1) 0%, rgba(191, 241, 103, 0.2) 100%);
        color: var(--primary-color);
    }

    .event-detail-icon.date-icon {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.2) 100%);
        color: #3b82f6;
    }

    .event-detail-icon.time-icon {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.2) 100%);
        color: #f59e0b;
    }

    .event-detail-icon.user-icon {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.2) 100%);
        color: #8b5cf6;
    }

    .event-detail-icon.price-icon {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 100%);
        color: #10b981;
    }

    .event-detail-icon.players-icon {
        background: linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(236, 72, 153, 0.2) 100%);
        color: #ec4899;
    }

    .event-detail-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .event-detail-label {
        font-size: 0.8rem;
        color: var(--gray-color);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .event-detail-value {
        font-size: 1rem;
        color: var(--secondary-color);
        font-weight: 600;
    }

    .event-actions {
        display: flex;
        gap: 12px;
        padding-top: 20px;
        border-top: 2px solid var(--card-border);
    }

    .event-action-btn {
        flex: 1;
        padding: 14px 24px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
    }

    .event-action-btn.btn-primary {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
        color: var(--secondary-color);
    }

    .event-action-btn.btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(158, 240, 26, 0.3);
    }

    .event-action-btn.btn-secondary {
        background: var(--card-bg);
        color: var(--gray-color);
        border: 2px solid var(--card-border);
    }

    .event-action-btn.btn-secondary:hover {
        background: var(--gray-light);
        transform: translateY(-2px);
    }

    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–±—ã—Ç–∏–π */
    :root[data-theme="dark"] .event-header h2 {
        color: var(--text-color);
    }

    :root[data-theme="dark"] .event-detail-card {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--card-border);
    }

    :root[data-theme="dark"] .event-detail-value {
        color: var(--text-color);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .event-details-grid {
            grid-template-columns: 1fr;
        }

        .event-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .event-header h2 {
            font-size: 1.3rem;
        }

        .event-actions {
            flex-direction: column;
        }
    }
</style>

<script>
// –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
function selectCourt(element, courtId, courtPrice) {
    console.log('–ö–æ—Ä—Ç –∫–ª–∏–∫–Ω—É—Ç!', courtId, courtPrice);

    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–æ—Ä—Ç–æ–≤
    document.querySelectorAll('.court-horizontal-item').forEach(item => {
        item.classList.remove('active');
        item.style.borderColor = '#eee';
        item.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.08)';
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É
    element.classList.add('active');
    element.style.borderColor = '#9ef01a';
    element.style.boxShadow = '0 15px 35px rgba(158, 240, 26, 0.2)';

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ—Ä—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    if (window.selectedCourtData) {
        window.selectedCourtData = {
            id: courtId,
            price: courtPrice,
            name: element.querySelector('h4').textContent
        };
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ—Ç—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ—Ä—Ç–∞
    if (window.selectedDate && window.loadTimeSlots) {
        const dateStr = window.formatDate ? window.formatDate(window.selectedDate) : new Date().toISOString().split('T')[0];
        window.loadTimeSlots(courtId, dateStr);
    }
}
</script>

<!-- –ü–†–û–°–¢–û–ô –ò –ù–ê–î–ï–ñ–ù–´–ô –°–ö–†–ò–ü–¢ –î–õ–Ø –°–ï–ö–¶–ò–ô -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üéØ Section handler loaded');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–æ–≤ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
    function setupSectionHandlers() {
        const sections = ['morning', 'day', 'evening'];

        sections.forEach(section => {
            const header = document.querySelector(`[data-section="${section}"]`);
            const content = document.getElementById(`${section}-slots`);

            if (!header || !content) {
                console.log(`‚ùå Section ${section} not found`);
                return;
            }

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            const newHeader = header.cloneNode(true);
            header.parentNode.replaceChild(newHeader, header);

            const newContent = content.cloneNode(true);
            content.parentNode.replaceChild(newContent, content);

            // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const currentHeader = document.querySelector(`[data-section="${section}"]`);
            const currentContent = document.getElementById(`${section}-slots`);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            currentHeader.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log(`üéØ Clicked ${section} section`);

                if (currentContent.style.display === 'none') {
                    currentContent.style.display = 'block';
                    const arrow = this.querySelector('.toggle-arrow i');
                    if (arrow) arrow.className = 'fas fa-chevron-down';
                    console.log(`‚úÖ ${section} opened`);
                } else {
                    currentContent.style.display = 'none';
                    const arrow = this.querySelector('.toggle-arrow i');
                    if (arrow) arrow.className = 'fas fa-chevron-right';
                    console.log(`‚úÖ ${section} closed`);
                }
            });

            currentHeader.style.cursor = 'pointer';
        });

        console.log('‚úÖ All sections initialized');
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    setTimeout(setupSectionHandlers, 100);

    // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ò–ü–û–ú –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø ==========
    const typeOptions = document.querySelectorAll('.type-option');
    const coachSelection = document.getElementById('coach-selection');
    const partnerSearchSection = document.getElementById('partner-search-section');
    const coachSelect = document.getElementById('coach-select');

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    typeOptions.forEach(option => {
        option.addEventListener('click', function() {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –æ–ø—Ü–∏–π
            typeOptions.forEach(opt => opt.classList.remove('active'));

            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–ø—Ü–∏–∏
            this.classList.add('active');

            // –û—Ç–º–µ—á–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π radio button
            const radio = this.querySelector('input[type="radio"]');
            if (radio) {
                radio.checked = true;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                if (radio.value === 'training') {
                    // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ç—Ä–µ–Ω–µ—Ä–∞, —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                    if (coachSelection) coachSelection.style.display = 'block';
                    if (partnerSearchSection) partnerSearchSection.style.display = 'none';

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–Ω–µ—Ä–æ–≤
                    loadCoaches();
                } else {
                    // –ò–≥—Ä–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–∞, —Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ç—Ä–µ–Ω–µ—Ä–∞
                    if (coachSelection) coachSelection.style.display = 'none';
                    if (partnerSearchSection) partnerSearchSection.style.display = 'block';
                    if (coachSelect) coachSelect.value = '';
                }
            }
        });
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–Ω–µ—Ä–æ–≤
    function loadCoaches() {
        fetch('/booking/api/coaches/')
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('coach-select');
                if (!select) return;

                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ "–ë–µ–∑ —Ç—Ä–µ–Ω–µ—Ä–∞")
                select.innerHTML = '<option value="">–ë–µ–∑ —Ç—Ä–µ–Ω–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</option>';

                // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–Ω–µ—Ä–æ–≤
                data.coaches.forEach(coach => {
                    const option = document.createElement('option');
                    option.value = coach.id;
                    option.textContent = `${coach.name} (‚≠ê ${coach.rating}) - ${coach.hourly_rate}‚ÇΩ/—á–∞—Å`;
                    option.dataset.rate = coach.hourly_rate;
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–Ω–µ—Ä–æ–≤:', error);
            });
    }
});
</script>


{% endblock %}

{% block extra_js %}
<script src="{% static 'js/booking.js' %}"></script>

<!-- FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

<script>
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FullCalendar
document.addEventListener('DOMContentLoaded', function() {
    if (typeof FullCalendar !== 'undefined') {
        console.log('‚úÖ FullCalendar library loaded successfully!', FullCalendar);
    } else {
        console.error('‚ùå FullCalendar library NOT loaded!');
    }
});
</script>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FullCalendar –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üéØ Initializing main calendar...');

    const calendarEl = document.getElementById('main-calendar');

    if (!calendarEl) {
        console.error('‚ùå Calendar element #main-calendar NOT found!');
        return;
    }

    console.log('‚úÖ Calendar element found');

    if (!window.FullCalendar) {
        console.error('‚ùå FullCalendar library not available!');
        return;
    }

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ru',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth'
        },
        buttonText: {
            today: '–°–µ–≥–æ–¥–Ω—è',
            month: '–ú–µ—Å—è—Ü'
        },
        height: 480,
        contentHeight: 420,
        aspectRatio: 2,
        nowIndicator: true,
        selectable: false,
        fixedWeekCount: false,
        displayEventTime: false,
        displayEventEnd: false,
        eventDisplay: 'block',

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞
        events: function(info, successCallback, failureCallback) {
            fetch(`/booking/api/calendar-events/?start=${info.startStr}&end=${info.endStr}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('üìÖ Calendar events loaded:', data.length, 'events');

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ data —ç—Ç–æ –º–∞—Å—Å–∏–≤
                    if (!Array.isArray(data)) {
                        console.error('‚ùå API returned non-array:', data);
                        successCallback([]);
                        return;
                    }

                    successCallback(data);
                })
                .catch(error => {
                    console.error('‚ùå Error loading calendar events:', error);
                    failureCallback(error);
                });
        },

        // –ö–ª–∏–∫ –ø–æ —Å–æ–±—ã—Ç–∏—é - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        eventClick: function(info) {
            info.jsEvent.preventDefault();
            showEventDetails(info.event);
        },

        // –ö–ª–∏–∫ –ø–æ –¥–∞—Ç–µ (–≤—ã–±–æ—Ä –¥–∞—Ç—ã –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
        dateClick: function(info) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –¥–∞—Ç–∞ –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const clickedDate = new Date(info.date);
            clickedDate.setHours(0, 0, 0, 0);

            if (clickedDate < today) {
                console.log('‚ö†Ô∏è Cannot select past date');
                if (window.toast) {
                    window.toast.warning('–ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å –ø—Ä–æ—à–µ–¥—à—É—é –¥–∞—Ç—É');
                }
                return;
            }

            console.log('üìÖ Date selected:', info.dateStr);

            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –¥–∞—Ç
            document.querySelectorAll('.fc-day').forEach(day => {
                day.classList.remove('selected-date');
            });

            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
            info.dayEl.classList.add('selected-date');

            // –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ booking.js
            if (window.bookingState) {
                window.bookingState.selectedDate = new Date(info.date);
                console.log('‚úÖ Updated booking state selectedDate:', window.bookingState.selectedDate);
            }

            // –ï—Å–ª–∏ –∫–æ—Ä—Ç —É–∂–µ –≤—ã–±—Ä–∞–Ω - –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ—Ç—ã
            if (window.selectedCourtData && window.selectedCourtData.id) {
                console.log('üéæ Court already selected, loading slots for', info.dateStr);
                if (window.loadTimeSlots && window.formatDate) {
                    const formattedDate = window.formatDate(new Date(info.date));
                    console.log('üì° Loading time slots for court', window.selectedCourtData.id, 'date', formattedDate);
                    window.loadTimeSlots(window.selectedCourtData.id, formattedDate);
                }
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–æ—Ä—Ç
                if (window.showTimeSlotsMessage) {
                    window.showTimeSlotsMessage('–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ç –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è');
                }
                console.log('üìç Date selected, waiting for court selection');
            }
        },

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
        eventClassNames: function(arg) {
            return ['fc-event-custom'];
        }
    });

    calendar.render();
    console.log('‚úÖ Main calendar rendered!');
    window.mainCalendar = calendar;

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(() => {
        const todayEl = document.querySelector('.fc-day-today');
        if (todayEl && window.bookingState) {
            todayEl.classList.add('selected-date');
            window.bookingState.selectedDate = new Date();
            console.log('üìÖ Auto-selected today:', new Date().toLocaleDateString());
        }
    }, 500);

    // ========== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –î–ï–¢–ê–õ–ï–ô –°–û–ë–´–¢–ò–Ø ==========
    function showEventDetails(event) {
        const modal = document.getElementById('eventDetailsModal');
        const props = event.extendedProps;

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
        const eventDate = new Date(event.start);
        const formattedDate = eventDate.toLocaleDateString('ru-RU', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
        const startTime = eventDate.toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit'
        });
        const endTime = new Date(event.end).toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit'
        });

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('event-court-name').textContent = props.courtName || '-';
        document.getElementById('event-date').textContent = formattedDate;
        document.getElementById('event-time').textContent = `${startTime} - ${endTime}`;
        document.getElementById('event-creator').textContent = props.creatorName || '-';
        document.getElementById('event-price').textContent = `${props.price || 0} ‚ÇΩ`;
        document.getElementById('event-players').textContent = `${props.partnersCount + 1} / ${props.maxPlayers}`;

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        const statusBadge = document.getElementById('event-status-badge');
        const statusMap = {
            'confirmed': { text: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ', class: 'status-confirmed' },
            'pending': { text: '–û–∂–∏–¥–∞–µ—Ç', class: 'status-pending' },
            'cancelled': { text: '–û—Ç–º–µ–Ω–µ–Ω–æ', class: 'status-cancelled' }
        };
        const status = statusMap[props.status] || { text: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ', class: '' };
        statusBadge.textContent = status.text;
        statusBadge.className = 'event-status-badge ' + status.class;

        // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        const actionsContainer = document.getElementById('event-actions');
        actionsContainer.innerHTML = '';

        if (props.isMine) {
            // –ú–æ—è –±—Ä–æ–Ω—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å"
            actionsContainer.innerHTML = `
                <a href="{% url 'profile' %}#bookings" class="btn-primary event-action-btn">
                    <i class="fas fa-user"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å
                </a>
            `;
        } else if (props.canJoin) {
            // –ú–æ–∂–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
            actionsContainer.innerHTML = `
                <button class="btn-primary event-action-btn" onclick="joinBooking(${props.bookingId})">
                    <i class="fas fa-user-plus"></i> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
                </button>
            `;
        } else {
            // –ü—Ä–æ—Å—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            actionsContainer.innerHTML = `
                <button class="btn-secondary event-action-btn" onclick="closeEventModal()">
                    <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                </button>
            `;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        modal.style.display = 'flex';
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function closeEventModal() {
        const modal = document.getElementById('eventDetailsModal');
        modal.style.display = 'none';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ
    function joinBooking(bookingId) {
        // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ —á–µ—Ä–µ–∑ AJAX
        console.log('Joining booking:', bookingId);
        alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
        closeEventModal();
    }

    // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ó–ê–ö–†–´–¢–ò–Ø –ú–û–î–ê–õ–¨–ù–´–• –û–ö–û–ù ==========
    document.addEventListener('click', function(e) {
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
        if (e.target.classList.contains('close-modal')) {
            e.target.closest('.modal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        if (e.target.classList.contains('modal')) {
            e.target.style.display = 'none';
        }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (modal.style.display === 'flex' || modal.style.display === 'block') {
                    modal.style.display = 'none';
                }
            });
        }
    });
});
</script>
{% endblock %}