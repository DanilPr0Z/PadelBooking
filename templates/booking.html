{% extends 'base.html' %}
{% load static %}

{% block title %}Бронирование - Paddle Booking{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Бронирование кортов</h1>
    <p>Выберите дату, корт и время для бронирования</p>
</div>

<!-- ГОРИЗОНТАЛЬНЫЙ КАЛЕНДАРЬ -->
<div class="calendar-container">
    <!-- Блок с месяцем -->
    <div class="month-header" style="
        text-align: center;
        margin-bottom: 15px;
        font-weight: 700;
        color: #333;
        font-size: 24px;
        padding: 10px 0;
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.1) 0%, rgba(191, 241, 103, 0.1) 100%);
        border-radius: 10px;
        border: 2px solid rgba(158, 240, 26, 0.2);
        width: 100%;
    ">
        Декабрь
    </div>

    <!-- Контейнер для навигации (стрелки слева и справа) -->
    <div class="week-controls" style="
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 10px;
        width: 100%;
    ">
        <!-- Кнопка "Предыдущая неделя" -->
        <button id="prev-week" class="week-arrow" type="button" title="Предыдущая неделя">
            <i class="fas fa-chevron-left"></i>
        </button>

        <!-- Контейнер для дней недели -->
        <div class="week-nav" id="week-nav" style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 5px;
            flex: 1;
            max-width: 800px;
            padding: 0;
            height: 90px;
            margin: 0 10px;
        ">
            <!-- JavaScript заполнит дни здесь -->
        </div>

        <!-- Кнопка "Следующая неделя" -->
        <button id="next-week" class="week-arrow" type="button" title="Следующая неделя">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
</div>

<!-- Основной контент страницы -->
<div class="booking-content">
    <div class="booking-sections">
        <!-- Левая колонка: Выбор корта -->
        <div class="section-left">
            <div class="section-card">
                <h3><i class="fas fa-court-sport"></i> Выберите корт</h3>
                <div id="courts-list" class="courts-list">
                    {% for court in courts %}
                    <div class="court-item" data-court-id="{{ court.id }}" data-court-price="{{ court.price_per_hour }}">
                        <div class="court-info">
                            <h4>{{ court.name }}</h4>
                            <span class="court-price">{{ court.price_per_hour }} ₽/час</span>
                        </div>
                        <div class="court-description">
                            <p>{{ court.description }}</p>
                        </div>
                        <div class="court-status">
                            {% if court.is_available %}
                            <span class="status-available"><i class="fas fa-check-circle"></i> Доступен</span>
                            {% else %}
                            <span class="status-unavailable"><i class="fas fa-times-circle"></i> Недоступен</span>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="no-courts">
                        <i class="fas fa-tennis-ball"></i>
                        <p>Нет доступных кортов в данный момент</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Правая колонка: Доступное время -->
        <div class="section-right">
            <div class="section-card">
                <h3><i class="fas fa-clock"></i> Доступное время</h3>
                <div id="time-slots" class="time-slots">
                    <div class="select-court-date">
                        <i class="fas fa-calendar-check"></i>
                        <p>Выберите дату и корт, чтобы увидеть доступное время</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно подтверждения бронирования -->
<div id="bookingConfirmModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Подтверждение бронирования</h2>
        <div class="booking-details">
            <div class="booking-detail-item">
                <span class="detail-label">Корт:</span>
                <span id="modal-court-name" class="detail-value"></span>
            </div>
            <div class="booking-detail-item">
                <span class="detail-label">Дата:</span>
                <span id="modal-date" class="detail-value"></span>
            </div>
            <div class="booking-detail-item">
                <span class="detail-label">Время:</span>
                <span id="modal-time" class="detail-value"></span>
            </div>
            <div class="booking-detail-item">
                <span class="detail-label">Стоимость:</span>
                <span id="modal-price" class="detail-value"></span>
            </div>
        </div>

        <form id="booking-form" method="post" action="{% url 'create_booking' %}">
            {% csrf_token %}
            <input type="hidden" name="court_id" id="form-court-id">
            <input type="hidden" name="date" id="form-date">
            <input type="hidden" name="start_time" id="form-start-time">
            <input type="hidden" name="end_time" id="form-end-time">
            <input type="hidden" name="duration" id="form-duration" value="1">

            <div class="form-actions">
                <button type="button" class="btn-secondary cancel-booking">Отмена</button>
                <button type="submit" class="btn-primary confirm-booking">Подтвердить бронирование</button>
            </div>
        </form>
    </div>
</div>

<style>
    /* Стили для календаря */
    .calendar-container {
        margin-bottom: 30px;
    }

    .month-header {
        text-align: center;
        margin-bottom: 15px;
        font-weight: 700;
        color: #333;
        font-size: 24px;
        padding: 10px 0;
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.1) 0%, rgba(191, 241, 103, 0.1) 100%);
        border-radius: 10px;
        border: 2px solid rgba(158, 240, 26, 0.2);
        width: 100%;
    }

    .week-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-bottom: 10px;
        width: 100%;
    }

    .week-arrow {
        width: 50px;
        height: 90px;
        border-radius: 8px;
        border: 2px solid #bff167;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        color: #38b000;
        font-size: 1.4rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
    }

    .week-arrow:hover:not(:disabled) {
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        border-color: #9ef01a;
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(158, 240, 26, 0.3);
    }

    .week-arrow:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        background: #f0f0f0;
        border-color: #d0d0d0;
        color: #888;
    }

    .week-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 5px;
        flex: 1;
        max-width: 800px;
        padding: 0;
        height: 90px;
        margin: 0 10px;
    }

    .week-day {
        cursor: pointer;
        height: 90px;
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-width: 60px;
        max-width: 70px;
        padding: 12px 5px;
        border-radius: 10px;
        background: #fafafa;
        border: 2px solid transparent;
        transition: all 0.3s;
        margin: 0 1px;
    }

    .week-day:hover:not(.selected) {
        background: rgba(158, 240, 26, 0.15);
        transform: translateY(-3px);
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        border-color: #bff167;
    }

    .week-day.selected {
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        border-color: #9ef01a;
        box-shadow: 0 5px 15px rgba(158, 240, 26, 0.3);
    }

    .weekday {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        font-weight: 700;
        margin-bottom: 6px;
        letter-spacing: 0.5px;
    }

    .week-day.selected .weekday {
        color: white;
        font-weight: 800;
    }

    .daynum {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-weight: 800;
        color: #333;
        background: white;
        border: 2px solid transparent;
        font-size: 16px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .week-day.selected .daynum {
        border-color: white;
        color: white;
        background: rgba(255, 255, 255, 0.2);
    }

    .week-day.today .daynum {
        border-color: #9ef01a;
        color: #7cc00f;
    }

    .week-day.today .weekday {
        color: #7cc00f;
    }

    /* Стили для кортов */
    .courts-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .court-item {
        padding: 20px;
        border-radius: 12px;
        background: white;
        border: 2px solid #eaeaea;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }

    .court-item:hover {
        transform: translateY(-5px);
        border-color: #bff167;
        box-shadow: 0 8px 20px rgba(158, 240, 26, 0.15);
    }

    .court-item.active {
        border-color: #9ef01a;
        background: linear-gradient(135deg, rgba(158, 240, 26, 0.05) 0%, rgba(191, 241, 103, 0.05) 100%);
        box-shadow: 0 8px 25px rgba(158, 240, 26, 0.2);
    }

    .court-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .court-info h4 {
        margin: 0;
        color: #333;
        font-size: 18px;
        font-weight: 700;
    }

    .court-price {
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 14px;
        box-shadow: 0 3px 8px rgba(158, 240, 26, 0.3);
    }

    .court-description p {
        margin: 0;
        color: #666;
        font-size: 14px;
        line-height: 1.5;
    }

    .court-status {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
    }

    .status-available {
        color: #38b000;
        font-weight: 600;
        font-size: 13px;
    }

    .status-available i {
        margin-right: 5px;
    }

    .status-unavailable {
        color: #dc3545;
        font-weight: 600;
        font-size: 13px;
    }

    .status-unavailable i {
        margin-right: 5px;
    }

    .no-courts {
        text-align: center;
        padding: 40px 20px;
        color: #888;
    }

    .no-courts i {
        font-size: 48px;
        margin-bottom: 15px;
        color: #ccc;
    }

    .no-courts p {
        margin: 0;
        font-size: 16px;
    }

    /* Стили для временных слотов */
    .time-slots {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
    }

    .time-slot {
        padding: 15px;
        border-radius: 10px;
        background: white;
        border: 2px solid #eaeaea;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }

    .time-slot.available {
        border-color: #bff167;
    }

    .time-slot.available:hover {
        background: linear-gradient(135deg, #9ef01a 0%, #bff167 100%);
        border-color: #9ef01a;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(158, 240, 26, 0.3);
    }

    .time-slot.available:hover .slot-time,
    .time-slot.available:hover .slot-status {
        color: white;
    }

    .time-slot.unavailable {
        opacity: 0.6;
        cursor: not-allowed;
        background: #f8f8f8;
    }

    .slot-time {
        display: block;
        font-weight: 700;
        color: #333;
        font-size: 16px;
        margin-bottom: 5px;
    }

    .slot-status {
        display: block;
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .time-slot.available .slot-status {
        color: #38b000;
    }

    .time-slot.unavailable .slot-status {
        color: #dc3545;
    }

    .select-court-date {
        text-align: center;
        padding: 40px 20px;
        color: #888;
        grid-column: 1 / -1;
    }

    .select-court-date i {
        font-size: 48px;
        margin-bottom: 15px;
        color: #ccc;
    }

    .select-court-date p {
        margin: 0;
        font-size: 16px;
    }

    .loading {
        text-align: center;
        padding: 30px;
        color: #666;
        grid-column: 1 / -1;
    }

    .loading i {
        margin-right: 10px;
    }

    .error-message {
        text-align: center;
        padding: 30px;
        color: #dc3545;
        grid-column: 1 / -1;
    }

    .error-message i {
        margin-right: 10px;
    }

    /* Добавьте эти анимации */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-50px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* Добавьте hover эффекты для кнопок в модальном окне */
    .btn-secondary:hover {
        background: #5a6268 !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3) !important;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #8edc19 0%, #a9d94c 100%) !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 5px 15px rgba(158, 240, 26, 0.3) !important;
    }

    .close-modal:hover {
        color: #333 !important;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    console.log('Booking page extra JS loaded');

    // Простая проверка что страница загружена
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Booking page DOM ready');
        console.log('User authenticated:', {% if user.is_authenticated %}true{% else %}false{% endif %});
        console.log('Courts count:', {{ courts.count }});
    });
</script>
<script src="{% static 'js/booking.js' %}" charset="UTF-8"></script>
{% endblock %}