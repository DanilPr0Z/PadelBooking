{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/dashboard.css' %}">
<style>
    /* –ü—Ä–æ—Å—Ç—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–µ—Ç—Ä–∏–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
    .dashboard-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: all 0.2s;
    }

    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .metric-value {
        font-size: 36px;
        font-weight: 700;
        color: #1e3a5f;
        margin-bottom: 8px;
    }

    .metric-label {
        font-size: 14px;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .metric-icon {
        font-size: 32px;
        margin-bottom: 12px;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
    <div class="dashboard-metrics">
        <div class="metric-card">
            <div class="metric-icon">üéæ</div>
            <div class="metric-value" id="today-bookings">-</div>
            <div class="metric-label">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
        </div>

        <div class="metric-card">
            <div class="metric-icon">üí∞</div>
            <div class="metric-value" id="today-revenue">-</div>
            <div class="metric-label">–î–æ—Ö–æ–¥ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
        </div>

        <div class="metric-card">
            <div class="metric-icon">üìà</div>
            <div class="metric-value" id="occupancy-rate">-</div>
            <div class="metric-label">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å –∫–æ—Ä—Ç–æ–≤</div>
        </div>

        <div class="metric-card">
            <div class="metric-icon">üë•</div>
            <div class="metric-value" id="new-users">-</div>
            <div class="metric-label">–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ -->
    <div style="margin-bottom: 20px;">
        <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <a href="{% url 'admin:booking_booking_add' %}" class="button">+ –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            <a href="/admin-panel/dashboard/" class="button">üìä –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
            <a href="/admin-panel/schedule/courts/" class="button">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ—Ä—Ç–æ–≤</a>
        </div>
    </div>

    <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Django admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    {% include "admin/app_list.html" with app_list=app_list show_changelinks=True %}
</div>

<script>
// –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ API
document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loading state
    document.getElementById('today-bookings').innerHTML = '<div style="font-size: 20px;">‚è≥</div>';
    document.getElementById('today-revenue').innerHTML = '<div style="font-size: 20px;">‚è≥</div>';
    document.getElementById('occupancy-rate').innerHTML = '<div style="font-size: 20px;">‚è≥</div>';
    document.getElementById('new-users').innerHTML = '<div style="font-size: 20px;">‚è≥</div>';

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    fetch('/admin-panel/api/dashboard-stats/')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load stats');
            return response.json();
        })
        .then(data => {
            const stats = data.financial || {};
            const occupancy = data.occupancy || {};
            const clients = data.clients || {};

            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
            document.getElementById('today-bookings').textContent = occupancy.total_bookings || 0;
            document.getElementById('today-revenue').textContent = Math.round(stats.total_revenue || 0).toLocaleString() + ' ‚ÇΩ';
            document.getElementById('occupancy-rate').textContent = Math.round(occupancy.overall_occupancy_rate || 0) + '%';
            document.getElementById('new-users').textContent = clients.new_users || 0;
        })
        .catch(error => {
            console.error('Error loading stats:', error);
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 0 –ø—Ä–∏ –æ—à–∏–±–∫–µ
            document.getElementById('today-bookings').textContent = '0';
            document.getElementById('today-revenue').textContent = '0 ‚ÇΩ';
            document.getElementById('occupancy-rate').textContent = '0%';
            document.getElementById('new-users').textContent = '0';
        });
});
</script>
{% endblock %}
